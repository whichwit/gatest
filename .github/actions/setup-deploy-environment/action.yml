name: Scaffold New Repository
description: 'Scaffolds a new repository with Terraform configuration to create the repository'

inputs:
  repository:
    description: 'Name for the new repository (name only)'
    required: true
    type: string
  token:
    description: 'GitHub Token with repo and workflow permissions'
    required: true
    type: string
  owner:
    description: 'GitHub username or organization that will own the new repository'
    required: true
    type: string
    default: 'amsrun'
  variables:
    description: Content for Terraform variable files
    required: false
    default: ''
    type: string

runs:
  using: 'composite'
  steps:
    - name: Create terraform.tfvars with inputs
      run: |
        cat <<'EOF' > ${{ github.action_path }}/terraform.tfvars
        ${{inputs.variables}}
        EOF
      shell: bash
    # - name: Create terraform.tfvars with inputs
    #   run: |
    #     cat <<'EOF' > ${{ github.action_path }}/terraform.tfvars
    #     github_token = "${{ inputs.token }}"
    #     github_repository = "${{ inputs.repository }}"
    #     environment_secrets = {
    #       "development": {
    #         "API_KEY": "dev-key",
    #         "DB_URL": "postgres://..."
    #       },
    #       "staging": {
    #         "API_KEY": "staging-key",
    #         "DB_URL": "postgres://..."
    #       },
    #       "production": {
    #         "API_KEY": "prod-key",
    #         "DB_URL": "postgres://..."
    #       }
    #     }
    #     environment_variables = {
    #       "development": {
    #         "LOG_LEVEL": "info"
    #       },
    #       "staging": {
    #         "LOG_LEVEL": "debug"
    #       },
    #       "production": {
    #         "LOG_LEVEL": "error"
    #       }
    #     }
    #     EOF
    #     cat ${{ github.action_path }}/terraform.tfvars
    #   shell: bash
    - name: Apply Terraform to Scaffold Repository
      uses: ./.github/actions/terraform-apply
      with:
        working-directory: ${{ github.action_path }}
